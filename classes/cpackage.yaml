inherit: [msvc::vcvars]
# Common class C/C++ based packages. It updates the various compiler flags
# variables so that the dependencies are found by the toolchains.

buildTools: [target-toolchain]
buildVars: [AUTOCONF_BUILD, AUTOCONF_HOST, TOOLCHAIN_FLAVOUR, CPPFLAGS, CFLAGS, CXXFLAGS, LDFLAGS]
buildSetup: |
    # Check if we're officially cross-compiling
    function cpackageCrossCompiling
    {
        if ("${Env:AUTOCONF_BUILD}" -ne "${Env:AUTOCONF_HOST}")
        {
            return 1 # cross compiling
        }
        else
        {
            return 0 # native build
        }
    }

    # Get desired library type: "static" or "shared".
    #
    # By default shared libraries are built when cross-compiling and static
    # libraries on host builds.
    function cpackageLibraryType
    {
        if(cpackageCrossCompiling)
        {
            "shared"
            return
        }
        else
        {
            "static"
            return
        }
    }

    if(${Env:TOOLCHAIN_FLAVOUR} -eq "msvc")
    {
        msvcLoadVcvars -VsInstallDir "$($BOB_TOOL_PATHS["target-toolchain"])"
    }

    # Gather all include and library paths.
    foreach ($i in ($args | select -skip 1))
    {
        $includePath = Join-Path $i "usr/include"
        if(Test-Path includePath)
        {
            ${Env:CPPFLAGS} += " -I$includePath"
        }
        foreach($j in @("lib", "usr/lib"))
        {
            $libPath = Join-Path $i $j
            if(Test-Path $libPath)
            {
                ${Env:LDFLAGS} +=" -LIBPATH:$libPath"
            }
        }
    }
