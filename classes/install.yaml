packageSetup: |
    function installCopy
    {
        Param(
            # mandatory
            [Parameter(Position = 0, mandatory=$true)]
            [String]$ROOT_DIRECTORY,
            # optional
            [Parameter(Position = 1, mandatory=$false)]
            [string[]]$PATTERNS=@()
        )

        $ROOT_DIRECTORY = (Resolve-Path $ROOT_DIRECTORY).Path

        $defaultExcludes = @(
            # remove documentation
            "usr\info",
            "usr\share\info",
            "usr\man",
            "usr\doc",
            "usr\share\man",
            "usr\share\doc",
            # remove not needed unix stuff
            "aclocal",
            "bash-completion",
            "emacs",
            "vim"
        )

        $includes = @()
        $excludes = @($defaultExcludes)

        foreach ($p in $PATTERNS)
        {
            if ($p.StartsWith("!"))
            {
                $excludes += $p.Substring(1)
            }
            else
            {
                $includes += $p
            }
        }

        $exclude_args = @()
        foreach ($exclude in $excludes)
        {
            $path = Join-Path $ROOT_DIRECTORY $exclude
            if (Test-Path $path)
            {
                $file = Get-Item($path)
                if (!$file.PSIsContainer)
                {
                    # exclude files
                    $exclude_args += "/XF"
                    $exclude_args += $(Get-Item $path).FullName
                }
                else
                {
                    # exclude directories
                    $exclude_args += "/XD"
                    $exclude_args += $(Get-Item $path).FullName
                }
            }
        }

        if ($includes.Count -gt 0)
        {
            foreach ($include in $includes)
            {
                $file = Get-Item (Resolve-Path(Join-Path $ROOT_DIRECTORY $include))
                if (!$file.PSIsContainer)
                {
                    # process files
                    $relative_install_dir = $($file.DirectoryName).Replace($ROOT_DIRECTORY, "")
                    robocopy "$($file.DirectoryName)" "${PWD}${relative_install_dir}" "$($file.Name)" $exclude_args "/COPY:DAT" "/R:0" "/W:0" >$null
                }
                else
                {
                    # process directories
                    $relative_install_dir = $($file.FullName).Replace($ROOT_DIRECTORY, "")
                    robocopy "$($file.FullName)" "${PWD}${relative_install_dir}" $exclude_args "/E" "/COPY:DAT" "/R:0" "/W:0" >$null
                }
            }
        }
        else
        {
            robocopy ${ROOT_DIRECTORY} ${PWD} $exclude_args "/E" "/COPY:DAT" "/R:0" "/W:0" >$null
        }
    }

    # Everything except shared or static libraries or header files.
    function installPackageBin
    {
        Param(
            # mandatory
            [Parameter(Position = 0, mandatory=$true)]
            [String]$ROOT_DIRECTORY
        )

        installCopy $ROOT_DIRECTORY
    }

    function InstallPackageTgt
    {
        Param(
            # mandatory
            [Parameter(Position = 0, mandatory=$true)]
            [String]$ROOT_DIRECTORY
        )

        installPackageBin $ROOT_DIRECTORY
    }

    # Only copy over headers, libs directly in library dir and cmake files.
    function installPackageDev
    {
        Param(
            # mandatory
            [Parameter(Position = 0, mandatory=$true)]
            [String]$ROOT_DIRECTORY
        )

        # TODO: add exclude filter
        installCopy $ROOT_DIRECTORY
    }

    # Only copy shared libraries.
    function installPackageLib
    {
        Param(
            # mandatory
            [Parameter(Position = 0, mandatory=$true)]
            [String]$ROOT_DIRECTORY
        )

        # TODO: add exclude filter
        installCopy $ROOT_DIRECTORY
    }
