packageSetup: |
    function msvcCreateDevenvScript
    {
        Param(
            [Parameter(Mandatory, Position = 1)]
            [String]$msvcToolsetVersion,
            [Parameter(Mandatory, Position = 2)]
            [String]$windowsSdkVersion,
            [Parameter(Mandatory, Position = 3)]
            [String]$VcToolsetVersion,
            [Parameter(Mandatory, Position = 4)]
            [String]$VcToolsetSuffix,
            [Parameter(Mandatory, Position = 5)]
            [String]$BuildToolsYear
        )

        'param(
        [string]$RootDir
    )

    $Includes = @(
        "${{RootDir}}\BuildTools\VC\Tools\MSVC\{0}\ATLMFC\include",
        "${{RootDir}}\BuildTools\VC\Tools\MSVC\{0}\include",
        "${{RootDir}}\Windows Kits\10\include\{1}\ucrt",
        "${{RootDir}}\Windows Kits\10\include\{1}\shared",
        "${{RootDir}}\Windows Kits\10\include\{1}\um",
        "${{RootDir}}\Windows Kits\10\include\{1}\winrt",
        "${{RootDir}}\Windows Kits\10\include\{1}\cppwinrt"
    )

    $Libpaths = @(
        "${{RootDir}}\BuildTools\VC\Tools\MSVC\{0}\ATLMFC\lib\x64",
        "${{RootDir}}\BuildTools\VC\Tools\MSVC\{0}\lib\x64",
        "${{RootDir}}\BuildTools\VC\Tools\MSVC\{0}\lib\x86\store\references",
        "${{RootDir}}\Windows Kits\10\UnionMetadata\{1}",
        "${{RootDir}}\Windows Kits\10\References\{1}"
    )

    $Libs = @(
        "${{RootDir}}\BuildTools\VC\Tools\MSVC\{0}\ATLMFC\lib\x64",
        "${{RootDir}}\BuildTools\VC\Tools\MSVC\{0}\lib\x64",
        "${{RootDir}}\Windows Kits\10\lib\{1}\ucrt\x64",
        "${{RootDir}}\Windows Kits\10\lib\{1}\um\x64"
    )

    $VsPath = @(
        "${{RootDir}}\BuildTools\VC\Tools\MSVC\{0}\bin\HostX64\x64",
        "${{RootDir}}\BuildTools\Common7\Tools\devinit",
        "${{RootDir}}\Windows Kits\10\bin\{1}\x64",
        "${{RootDir}}\Windows Kits\10\bin\x64",
        "${{RootDir}}\BuildTools\MSBuild\Current\Bin",
        "${{RootDir}}\BuildTools\Common7\Tools\"
    )

    $Env:INCLUDE = ""
    $Env:LIBPATH = ""
    $Env:LIB = ""
    $Env:VS_PATH = ""

    foreach($path in $Includes)
    {{
        $Env:INCLUDE = $Env:INCLUDE + $path + ";"
    }}

    foreach($path in $Libpaths)
    {{
        $Env:LIBPATH = $Env:LIBPATH + $path + ";"
    }}

    foreach($lib in $Libs)
    {{
        $Env:LIB = $Env:LIB + $lib + ";"
    }}

    foreach($path in $VsPath)
    {{
        $Env:VS_PATH = $Env:VS_PATH + $path + ";"
    }}

    $Env:Platform               = "x64"
    $Env:PROCESSOR_ARCHITECTURE = "AMD64"
    $Env:VSCMD_ARG_HOST_ARCH    = $Env:Platform
    $Env:VSCMD_ARG_TGT_ARCH     = $Env:Platform

    $Env:MSB_PATH             = "${{RootDir}}\BuildTools\MSBuild\Current\Bin\amd64"

    $Env:VCInstallDir          = "${{RootDir}}\BuildTools\VC"
    $Env:VCInstallDir_{3}      = $Env:VCInstallDir
    $Env:VCToolsInstallDir     = "${{RootDir}}\BuildTools\VC\Tools\MSVC\{0}"
    $Env:VCToolsInstallDir_{3} = $Env:VCToolsInstallDir
    $Env:VCToolsVersion        = "{0}"

    $Env:WindowsSdkBinPath    = "${{RootDir}}\Windows Kits\10\bin"
    $Env:WindowsSdkDir        = "${{RootDir}}\Windows Kits\10"
    $Env:WindowsSDKLibVersion = "{1}"
    $Env:WindowsSdkVerBinPath = "${{RootDir}}\Windows Kits\10\bin\{1}"
    $Env:WindowsSDKVersion    = "{1}"


    # This environment variable is by default set to "true" we still set it here to be sure that
    # the environment set from within this file is always used by the visual studio toolchain
    $Env:UseEnv=$true

    # This environment variable defaults to "false" which means that the visual studio always scan
    # the windows registry to gather paths to several tools and versions. Setting this variable to
    # "true" ensures that the environment from this file is use in the first place.
    $Env:DisableRegistryUse=$true

    Write-Host "**********************************************************************"
    Write-Host "** Setup visual studio v{2} (VS {4}) development environment         "
    Write-Host "**********************************************************************"

    Write-Host INCLUDE = $Env:INCLUDE
    Write-Host LIBPATH = $Env:LIBPATH
    Write-Host LIB     = $Env:LIB
    Write-Host VS_PATH = $Env:VS_PATH

    Write-Host Platform               = $Env:Platform
    Write-Host PROCESSOR_ARCHITECTURE = $Env:PROCESSOR_ARCHITECTURE

    Write-Host MSB_PATH = $Env:MSB_PATH

    Write-Host VCInstallDir          = $Env:VCInstallDir
    Write-Host VCInstallDir_{3}      = $Env:VCInstallDir_{3}
    Write-Host VCToolsInstallDir     = $Env:VCToolsInstallDir
    Write-Host VCToolsInstallDir_{3} = $Env:VCToolsInstallDir_{3}
    Write-Host VCToolsVersion        = $Env:VCToolsVersion

    Write-Host WindowsSdkBinPath     = $Env:WindowsSdkBinPath
    Write-Host WindowsSdkDir         = $Env:WindowsSdkDir
    Write-Host WindowsSDKLibVersion  = $Env:WindowsSDKLibVersion
    Write-Host WindowsSdkVerBinPath  = $Env:WindowsSdkVerBinPath
    Write-Host WindowsSDKVersion     = $Env:WindowsSDKVersion' -f "${msvcToolsetVersion}", `
                                                                  "${windowsSdkVersion}", `
                                                                  "${VcToolsetVersion}", `
                                                                  "${VcToolsetSuffix}", `
                                                                  "${BuildToolsYear}" | Out-File -encoding utf8 ${PWD}\setup_devenv.ps1
    }
