inherit: [cmake]

metaEnvironment:
    PKG_VERSION: "1.13.0"

checkoutSCM:
    scm: url
    url: ${GITHUB_MIRROR}/google/googletest/archive/refs/tags/v${PKG_VERSION}.zip
    digestSHA256: ffa17fbc5953900994e2deec164bb8949879ea09b411e07f215bfbb1f87f4632

buildVars: [PKG_VERSION]
buildScript: |
    cmakeBuild "$($args[0])/googletest-${Env:PKG_VERSION}" `
               -Dgtest_build_samples=OFF `"

packageScript: |
    cmakePackageTgt

    mkdir -Force -p usr/etc/ide >$null
    pushd usr/etc/ide

    # Required for the IDE Setup.
    'defines: []

    publicHeader:
        - googletest-{0}\googlemock\include
        - googletest-{0}\googletest\include
    privateHeader:
        - googletest-{0}\googlemock\src
        - googletest-{0}\googletest\src' -f "${Env:PKG_VERSION}" | Out-File -encoding ASCII package.cfg
    popd