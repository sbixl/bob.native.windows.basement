shared: True
inherit: [lessmsi, filesystem, msvc::buildtools, msvc::devenv]

buildScript: |
    # Always build the package from scratch
    DeleteDirectory ${PWD}
    # Extract msi and vsix archives
    $buildToolsDepPath = "$($args[1])"
    MSVC-ExtractBuildTools $buildToolsDepPath

packageDepends: True
packageVars: [WINDOWS_SDK_VERSION, MSVC_TOOLSET_VERSION, VC_VER, VS_YEAR]
packageScript: |
    # Always package from scratch
    DeleteDirectory ${PWD}\*

    # Create visual studio shell environment script
    MSVC-CreateDevenvScript $Env:MSVC_TOOLSET_VERSION `
                            $Env:WINDOWS_SDK_VERSION `
                            $Env:VC_VER `
    	                    $Env:VS_YEAR

    MSVC-PackageBuildTools "$($args[0])"

    Write-Host "################## Copying Windows SDK ${Env:WINDOWS_SDK_VERSION}"
    $windows_sdk_dir = "$($args[2])"
    cp -r -Force  ${windows_sdk_dir}\* .

multiPackage:

    v142-x86_x64:

        metaEnvironment:
            VC_VER: "142"
            VS_YEAR: "2019"

        depends:
            - name: devel::msvc::vs2019-buildtools-layout
              use: [result, environment]
            - name: devel::win10-sdk
              use: [result, environment]

    v143-x86_x64:

        metaEnvironment:
            VC_VER: "143"
            VS_YEAR: "2022"

        depends:
            - name: devel::msvc::vs2022-buildtools-layout
              use: [result, environment]
            - name: devel::win11-sdk
              use: [result, environment]

    v145-x86_x64:

        metaEnvironment:
            VC_VER: "145"
            VS_YEAR: "2026"

        depends:
            - name: devel::msvc::vs2026-buildtools-layout
              use: [result, environment]
            - name: devel::win11-sdk
              use: [result, environment]

provideTools:
    host-toolchain:
        path: ""

    target-toolchain:
        path: ""

provideVars:
    AUTOCONF_HOST: "x86_64-pc-windows-msvc"

    MSVC_TOOLSET_VERSION:   $MSVC_TOOLSET_VERSION
    WINDOWS_SDK_VERSION:    $WINDOWS_SDK_VERSION
    PROCESSOR_ARCHITECTURE: "AMD64"

    CC: "cl"
    CXX: "cl"

    CPPFLAGS: ""
    CFLAGS: ""
    CXXFLAGS: ""
    LDFLAGS: ""
