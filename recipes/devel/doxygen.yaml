shared: True

inherit: [cmake]

# see: https://github.com/doxygen/doxygen/issues/10262
environment:
    PARALLEL_JOBS: "1"

metaEnvironment:
    PKG_VERSION: "1_15_0"

depends:
    - name: devel::flex
      use: [tools]
    - name: devel::bison
      use: [tools]

checkoutSCM:
    scm: url
    url: ${GITHUB_MIRROR}/doxygen/doxygen/archive/refs/tags/Release_${PKG_VERSION}.zip
    digestSHA256: 2eba5f9c3f3f4e7a7ed8e147b5db355bdb7e3979648ab36ba8350ec9ea1f2fc4

buildTools: [flex, bison]
buildVars: [PKG_VERSION]
buildScript: |
    cmakeBuild -GNinja `
               -DCMAKE_BUILD_TYPE=RELEASE `
               -Dbuild_wizard=OFF `
               -Dbuild_app=OFF `
               -Dbuild_parse=OFF `
               -Dbuild_xmlparser=OFF `
               -Dbuild_search=OFF `
               -Dbuild_doc=OFF `
               -Duse_sqlite3=OFF `
               -Duse_libclang=OFF `
               -Dwin_static=ON `
               "$($args[0])\doxygen-Release_${Env:PKG_VERSION}"

packageScript: |
    cmakePackageBin

provideTools:
    doxygen: usr/bin
